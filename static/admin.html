<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin â€” Dental Bot Onboard</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;padding:20px;background:#fbfdff}
    .card{max-width:820px;margin:0 auto;background:#fff;border-radius:10px;padding:18px;border:1px solid #eef}
    label{display:block;margin-top:8px;font-weight:700}
    input,textarea,select{width:100%;padding:8px;border:1px solid #ddd;border-radius:8px;margin-top:6px}
    button{background:#0ea5e9;color:#fff;padding:10px 12px;border-radius:8px;border:0;cursor:pointer}
    .row{display:flex;gap:12px}
    .col{flex:1}
    pre{background:#f8fafc;padding:10px;border-radius:8px;overflow:auto}
    .actions{display:flex;gap:8px;margin-top:12px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Onboard Clinic</h2>
    <div>
      <label>Admin API Key</label>
      <input id="apiKey" type="password" placeholder="x-api-key (admin)" />

      <label>Clinic ID</label>
      <input id="clinicId" placeholder="smile-city-001" />

      <div class="row">
        <div class="col">
          <label>Clinic name</label>
          <input id="clinicName" />
        </div>
        <div class="col">
          <label>Contact email</label>
          <input id="contactEmail" />
        </div>
      </div>

      <label>Booking URL</label>
      <input id="bookingUrl" placeholder="https://booking.example.com/" />

      <label>Logo URL (optional)</label>
      <input id="logoUrl" />

      <label>Preview text (widget greeting)</label>
      <input id="previewText" placeholder="Hi! Ask me about services and bookings." />

      <label>Extra JSON (optional)</label>
      <textarea id="extra" rows="3" placeholder='{"plan":"pro"}'></textarea>

      <div class="actions">
        <button id="saveBtn">Save & Send Onboarding</button>
        <button id="copySnippetBtn">Copy Embed Snippet</button>
      </div>

      <h4 style="margin-top:14px">Embed snippet</h4>
      <pre id="snippetPreview">(after save the embed snippet will appear here)</pre>

      <h4 style="margin-top:12px">Widget preview</h4>
      <div id="widgetPreview" style="width:340px;height:200px;border:1px solid #eee;border-radius:10px;padding:12px;overflow:auto">
        <div style="font-weight:700">Clinic Assistant</div>
        <div style="color:#666;font-size:13px">Preview will show greeting and CTA after save</div>
      </div>

      <div id="out" style="margin-top:12px;color:#333;font-size:13px"></div>
    </div>
  </div>

  <script>
  function snippetFor(clinicId, apiBase) {
    return `<script src="${(window.__DBOT_WIDGET_SRC||'')||'/static/widget.js'}" data-clinic="${clinicId}" data-api="${apiBase}"></script>`;
  }

  document.getElementById('saveBtn').onclick = async function(){
    const apiKey = document.getElementById('apiKey').value.trim();
    const payload = {
      clinic_id: document.getElementById('clinicId').value.trim(),
      clinic_name: document.getElementById('clinicName').value.trim(),
      contact_email: document.getElementById('contactEmail').value.trim(),
      booking_url: document.getElementById('bookingUrl').value.trim(),
      logo_url: document.getElementById('logoUrl').value.trim(),
      preview_text: document.getElementById('previewText').value.trim()
    };
    try{ Object.assign(payload, JSON.parse(document.getElementById('extra').value || '{}')); }catch(e){}
    const res = await fetch('/admin/clinics', { method:'PUT', headers:{'Content-Type':'application/json','x-api-key': apiKey}, body: JSON.stringify(payload)});
    const data = await res.json().catch(()=>({status:res.status}));
    document.getElementById('out').textContent = JSON.stringify(data,null,2);
    if (data && data.embed_snippet) {
      document.getElementById('snippetPreview').textContent = data.embed_snippet;
      // update preview
      document.getElementById('widgetPreview').innerHTML = `<div style="font-weight:800">${payload.clinic_name||'Clinic Assistant'}</div><div style="margin-top:6px">${payload.preview_text||'Hi! I can help with bookings and questions.'}</div>`;
    }
  };

  document.getElementById('copySnippetBtn').onclick = function(){
    const text = document.getElementById('snippetPreview').textContent;
    if (!text) return;
    navigator.clipboard.writeText(text).then(()=>{ alert('Snippet copied to clipboard'); }).catch(()=>{ alert('Copy failed'); });
  };
  </script>

</body>
</html>
